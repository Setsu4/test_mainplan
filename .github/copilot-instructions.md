## 概要

このリポジトリは「ChatGPT API を使ってニュース記事の要約プロンプト実験」を行うための作業ディレクトリになります。
目的はプロンプトのバリエーションを試して最適な要約プロンプトを見つけることです。実行は小さなスクリプトで行い、プロンプトはテキストファイルで管理します。

## 期待されるディレクトリとファイル（命名規則）

- `data/` - CSV やサンプル記事を保存（例: `data/sample.csv`）
- `prompts/` - プロンプトテンプレート（例: `prompts/summarize.txt`）。テンプレート内は `{{ARTICLE}}` のようなプレースホルダを使う。
- `src/` - 実行スクリプト（例: `src/run_summary.py`）
- `.env` / `.env.example` - 環境変数（`OPENAI_API_KEY` 等）
- `requirements.txt` または `pyproject.toml` - 依存管理

## CSV フォーマット（このプロジェクト固有）

2つの運用パターンをサポートします。どちらかを選んでください。

1) 単純な1列フォーマット（すぐ試せる）
  - `data/sample.csv` の 1 行目に元記事テキストを入れる。スクリプトは 2 行目に要約を書き込みます。
  - 使い方: テスト用に短い記事を1つ入れて挙動確認するのに便利。

2) 推奨: 列ベース（拡張性あり）
  - ヘッダあり CSV: `id,article,summary`。`summary` は空で始める。
  - スクリプトは `article` を読み、`summary` カラムに結果を書く（複数記事のバッチ処理に向く）。

## プロンプト管理（重要）

- `prompts/summarize.txt` は生テキストのテンプレートにしてください。例:

  """
  あなたは熟練の要約者です。以下のニュース記事を日本語で簡潔に要約してください（3 文以内）。
  記事:
  {{ARTICLE}}
  注意: 事実を捏造しないでください。重要度の高い構成要素（いつ・どこで・誰が・何を）を必ず含めてください。
  """

- スクリプトはテンプレート内の `{{ARTICLE}}` を置換して API に送る。

## API と実行ルール

- API キーは `OPENAI_API_KEY` 環境変数で渡す（`.env` を利用）。
- 長文記事はトークン制限のため事前に切り出す（先頭 N トークン／セクション要約→再要約の2段階）を検討する。
- レート制限に注意。バッチ処理は小さなバッチサイズ（例: 5）で試す。

## 開発・実験ワークフロー（短い手順）

1. `prompts/summarize.txt` を編集してプロンプトを作る。
2. `data/sample.csv` を用意（上のフォーマット参照）。
3. 仮の `OPENAI_API_KEY` を `.env` に入れてテスト実行。
4. `src/run_summary.py` を実行して API 呼び出し→CSV に書き戻す。

## 例: 主要スクリプトの責務

- `src/run_summary.py`: CSV を読み、プロンプトテンプレートを読み込み、API 呼び出しを行い、レスポンスを CSV に追記する。エラー時は `errors.log` に記録する。
- `src/utils.py`: プロンプト置換、トークン見積り、CSV 読み書きユーティリティ。

## 注意事項・ローカルルール

- 生成された要約は検証用に必ず human-in-the-loop でチェックすること（評価ラベル付けを想定）。
- `.env` はコミットしない（`.gitignore` に追加）。サンプルは `.env.example` に置く。
- プロンプトの変更は `prompts/` 内の別ファイルに保存してバージョン管理する（例: `prompts/summarize_v1.txt`）。

